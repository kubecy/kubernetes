apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-webhook-dingtalk-config
  namespace: monitoring
data:
  config.yml: |
    ## Request timeout
    # timeout: 5s

    ## Customizable templates path
    templates:
      - /etc/prometheus-webhook-dingtalk/dingtalk_template.tmpl 

    ## You can also override default template using default_message
    default_message:
      title: '{{ template "legacy.title" . }}'
      text: '{{ template "dingtalk.default.message" . }}'

    ## Targets, previously was known as "profiles"
    targets:
      webhook1:
        url: https://oapi.dingtalk.com/robot/send?access_token=5f7c505d6554e5842ddee5cbee2d6c1eb079ed36bc9bd5e6bc9ffaf1acf6ca68 
        secret: SECd8d89f4d1e0fadf735bb8030e1306ea9955ce6c178b4083d64d42acad4d6735a 
#        message:
#          ## æŒ‡å®šäº†æ¶ˆæ¯çš„æ ‡é¢˜ï¼Œä½¿ç”¨æ¨¡æ¿ `ding.link.title` æ¥ç”Ÿæˆã€‚
#          title: '{{ template "ding.link.title" . }}'
#          # æŒ‡å®šäº†æ¶ˆæ¯çš„æ­£æ–‡å†…å®¹ï¼Œä½¿ç”¨æ¨¡æ¿ `ding.link.content` æ¥ç”Ÿæˆã€‚
#          text: '{{ template "ding.link.content" . }}'
                        
  dingtalk_template.tmpl: |
    {{ define "dingtalk.default.message" }}
    {{- if gt (len .Alerts.Firing) 0 }}
    {{- range .Alerts }}
    ### ğŸš¨æ…•ä¸€æ•…éšœå‘Šè­¦
    - **å‘Šè­¦ç±»å‹**: {{ .Labels.alertname }}
    - **å‘Šè­¦çº§åˆ«**: {{ .Labels.severity }}
    - **æ•…éšœæè¿°**: {{ .Annotations.description }}
    - **æ•…éšœè¯¦æƒ…**: {{ .Annotations.summary }}
    - **æ•…éšœæ—¶é—´**: {{ (.StartsAt.Add 28800e9).Format "2006-01-02 15:04:05" }}
    {{- if .Labels.instance }}
    - **å®ä¾‹ä¿¡æ¯**: {{ .Labels.instance }}
    {{- end }}
    ---
    {{- end }}
    {{- end }}
    
    {{- if gt (len .Alerts.Resolved) 0 }}
    {{- range .Alerts }}
    ### âœ…æ…•ä¸€æ•…éšœæ¢å¤
    - **å‘Šè­¦ç±»å‹**: {{ .Labels.alertname }}
    - **å‘Šè­¦çº§åˆ«**: {{ .Labels.severity }}
    - **æ•…éšœæè¿°**: {{ .Annotations.description }}
    - **æ•…éšœè¯¦æƒ…**: {{ .Annotations.summary }}
    - **æ•…éšœæ—¶é—´**: {{ (.StartsAt.Add 28800e9).Format "2006-01-02 15:04:05" }}
    {{- if .Labels.instance }}
    - **å®ä¾‹ä¿¡æ¯**: {{ .Labels.instance }}
    {{- end }}
    ---
    {{- end }}
    {{- end }}
    {{ end }}

